It's pretty hacky, not very flexible, and uses way more memory than it needs to, but it passes all the tests.
